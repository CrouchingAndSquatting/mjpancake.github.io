---
layout: page
title: 变量与类型
permalink: /docs/editor/var/
---

「松饼人物编辑器：从入门到欧耶」系列教程（二）

## 上一讲的习题参考答案

1) 略
2) 略
3) 把 TA 吊起来啪啪啪。

<br />

## 变量

为了把人物技能做得明明白白，
学一些 Lua 的基础知识是免不了的。
即使不知道接下来要讲的知识点和人物技能有啥关系，
也要静下心来，慢慢理解 ——
扎实的基础对于理解人物技能而言乃是重中之重。

先看一个例子。
新建人物，名字随便填一个，尬入以下代码：

```lua
a = 42
print(a)
a = 233
print(a)
```

三狗测试，发现依次输出 42 和 233。

这个例子中，`a`是一个「变量」。
一个变量代表一块内存空间 ——
我们可以向这个空间里写入数据，
也可以从这个空间里读取数据。
下面详细分解一下这四行代码的作用。

- 第一行的`a = 42`，就是向`a`这个变量里写入 42 这个值。
  第一行执行结束以后，42 这个值就乖乖躺在`a`里了。
- 第二行的`print(a)`读取并输出了`a`此时此刻的值 —— 也就是 42。
  第二行执行以后，`a`里的值还是 42 —— 读取并不会改变`a`。
- 第三行的`a = 233`，向`a`这个变量里写入了 233 这个值，
  之前的 42 会被覆盖掉 ——
  请想象 42 被赶出屋外，而屋子又被 233 占领的景象。
  现在`a`里装着的值已经是 233 了。
- 于是第四行的`print(a)`就会输出 233。

向一个变量里写入一个值，叫「赋值」。
表示赋值的符号是`=`，也就是一个等号。
上面的例子中，我们先后通过`=`将`a`的值修改成了 42 和 233。

回忆一下，两个等号`==`用来判断是否相等，别搞混了。

那么问题来了，在我们把 42 存进`a`以前，`a`是多少？

试一下不就得了：

```lua
print(a)
a = 42
print(a)
```

三狗测试，发现先后输出 `nil` 和 42。
也就是说，在我们往`a`里放 42 以前，
`a`是`nil`。`nil`又是个什么鬼？

这不明摆着吗，`nil`就是啥也没有的意思。
我们没往`a`里放东西，`a`里当然啥也没有。

我们可以通过给一个变量赋`nil`，以达到清空一个变量的目的：

```lua
print(a)
a = 42
print(a)
a = nil
print(a)
```

该代码依次输出 `nil`, 42, `nil`。

<br />

## 表达式

猜猜这段代码输出什么，并用三狗测试验证猜测：

```lua
a = 3
b = 2
c = a + b
d = a - b
e = a * b
f = a / b
g = c + d * e - f
print(g)
```

每一行代码的作用如下：
- `a = 3`，把 3 存进`a`。
- `b = 2`，把 2 存进`b`。
- `c = a + b`，计算`a + b`，将结果存入`c`。
- `d = a - b`，计算`a - b`，将结果存入`d`。
- `e = a * b`，计算`a * b`，将结果存入`e`。
   在 Lua 中，`*`代表乘号。
- `f = a / b`，计算`a / b`，将结果存入`f`。
   在 Lua 中，`/`代表除号。
- `g = c + d * e - f`，计算`c + d * e - f`，将结果存入`g`。
  乘除优先于加减……啥的就不用说了吧x
- `print(g)` 输出`g`的值。

赋值号`=`的右侧可以是个「表达式」。
像 3，2 这种数字都是表达式，
像 `a`, `b` 这种变量也是表达式，
像 `a + b`, `a - b` 这种式子也是表达式，
像 `f - g * 3 + c` 这种一长串式子也都是表达式。

表达式是个很强大的东西。
灵活运用表达式，可以让代码变得更简洁。
比如上面的那段代码，也可以这么写：

```lua
a = 3
b = 2
g = (a + b) + (a - b) * (a * b) - (a / b)
print(g)
```

通过这种写法，中间的`c`, `d`, `e`, `f`都省掉了，
代码一下子短了不少。

或者也可以直接把一长串写在参数的位置上：

```lua
a = 3
b = 2
print((a + b) + (a - b) * (a * b) - (a / b))
```

这样一来，`g`这个变量也省掉了。

其实还可以更进一步，把`a`和`b`也省掉：

```lua
print((3 + 2) + (3 - 2) * (3 * 2) - (3 / 2))
```

但这么写有一个缺点：如果你想把`a`改成 4，怎么办？
只能屁巅屁巅地把所有的 3 都一个个改成 4，不但累，还有可能漏改。
但之前的代码就不一样了，直接把`a = 3`改成`a = 4`就行了。
可见，代码并不一定越短越好。
一般来讲，当某个东西会被用到多次时，
就有必要为它定义出一个什么东西出来。
就像上面的 3，因为出现了 4 次，
所以我们为它定义出了一个变量`a`，以便集中修改。

上面的例子中的表达式里用到了括号。
有些时候，即使是不影响计算的优先级，也会多加几个括号 ——
主要是为了确保万无一失，同时也是为了改起来更方便。

<br />

## 变量名

上面的例子里，我们用了`a`, `b`, `c`, `d`这样的简单变量名。
其实变量名还可以很长：

```lua
wwww = 2333
emmmmmmmmmmmmmmmmmmmmmmm = 66666
```

Lua 是区分大小写的：

```lua
emmm = 2333
Emmm = 66666
print(emmm)
print(Emmm)
```

上面的代码输出 2333 和 66666，可见`emmm`和`Emmm`是两个不同的变量。

变量名可以由字母、数字、和下划线组成，同时不能以数字开头。
虽然可以用大写，但习惯上一般只用小写变量名。

在三次元中，你可以给你家的狗起名为`if`，
但在 Lua 中这是非法的 —— `if`这个词已经被 Lua 保留了，
它是用来写`if`语句的，不能再用`if`给变量命名。
像`if`这种不能用来给变量命名的词，叫「关键字」。
在 Lua 中，以下单词都是关键字：

```lua
and       break     do        else      elseif
end       false     for       function  if
in        local     nil       not       or
repeat    return    then      true      until     while
```

使用关键字命名变量是非法的。
除此之外，有些变量名虽然合法，但不道德 ——
这就好比三次元中，给小孩起一些奇怪的名字，会影响他们的人生一样。
比如`_G`, `_ENV`这种「下划线开头 + 大写字母」的变量名，
还有`__index`, `__add` 这种「双下划线开头」的变量名，
通常具有一些特殊意义，拿它们给变量命名是作死行为，
鬼才知道会有什么后果。

不道德的名字有四种：

1. 下划线开头 + 大写字母
2. 双下划线开头
3. Lua 标准库中的变量名
4. 松饼 API 中的变量名

其中 1 和 2 上面已经见过了，现在解释下 3 和 4。
一个典型的 Lua 标准库变量名，就是`print` ——
这个函数是 Lua 自带的，我们已经用过很多次了。
用`print`给你自己的变量命名是作死行为，比如下面的代码：

```lua
haha = 2333
print = 6666
print(haha)
```

三狗测试，发现这段代码并不会输出 2333，而是报了一个错 ——
这是因为，执行第一行的`print = 6666`以后，
`print`已不再是用来输出的那个函数，而是 6666。
那原来的`print`函数哪儿去了？嗯，没了。

松饼 API 也是同样的道理：

```lua
ondraw = 2333
```

回顾上一讲的内容，`ondraw`这个名字是用来定义摸牌挂的。
现在却用它来存 2333，实属作死。

<br />

## 自增

新建人物：

```lua
a = 5
a = a + 1
print(a)
```

三狗测试，输出 6。

三行代码作用如下：

- `a = 5`，将 5 存入 `a`
- `a = a + 1`，计算`a + 1`，得 6，再将 6 存入`a`
- `print(a)`，输出此时`a`的值，也就是 6

这里其实没有新知识点，
只是某些人可能需要适应`a = a + 1`这种东西。

<br />

## 类型

世上的一切事物都是有类型的。
对于不同类型的事物，我们所能做的事情也不同。

比如，苹果、麻婆豆腐、炸鸡都是「食物」类型的。食物可以吃。
而桌子、椅子、床都是「家具」类型的。家具不能吃，但可以踢。
至于游泳、上吊、捉奸则是属于「行动」类型的。
行动不能吃，不能踢，但可以做。

三次元尚如此，况 Lua 乎？
在 Lua 中，数据一共有 7 种类型：

- number
- string
- boolean
- table
- function
- userdata
- nil

### 类型 number

number 就是数字，数字可以用来加减乘除，就好比食物可以吃一样。

我们已经用过好多次数字了，不再赘述：

```lua
a = 23333
b = a + 777
```

### 类型 string

string 就是字符串。所谓字符串，就是一些文字组成的串。
在 Lua 中，可通过双引号表示字符串：

```lua
a = "hahaha"
print(a)
```

三狗测试，见这段代码输出「hahaha」。

我们可以通过`..`（两个点）拼接两个字符串：

```lua
a = "hahaha"
b = "hehehe"
c = a .. b
print(c)
```

三狗测试，见这段代码输出「hahahahehehe」。

字符串可以拼接，但不能加減乘除。
这就好比家具可以踢，但不能吃一样。

```lua
a = "haha"
b = "hehe"
c = a + b
print(c)
```

三狗测试，见这段代码报错。

其实有些家具也是可以吃的，比如用麻婆豆腐做成的床就可以吃：

```lua
a = "12"
b = "34"
c = a + b
print(c)
```

上面的代码输出 46。虽然可以正常运行，
但没事别老写这种做死的代码 ——
整天把床当成麻婆豆腐吃，迟早要完。
数字就是数字，字符串就是字符串。

### 类型 boolean

boolean 只有两种值：`true`和`false`。
具体细节以后会详细讲。

```lua
a = true
b = false
```

### 类型 table

table 是一种万能的东西，
可以用来做各种数据结构。
至于「数据结构」是个什么鬼，以后再说。

```lua
a = { 1, 2, 3, 4, 5 }
b = { width = 200, name = "doge" }
print(a[3])
print(b.name)
```

### 类型 function

function 就是函数类型。
这个也以后再详细说吧x

```lua
square = function(n)
  return n * n
end

a = square(3)
print(a)
```

### 类型 userdata

Lua 这门语言通常用来去「扩展」其它应用。
userdata 就是那些被扩展的应用为 Lua 添加的新类型。
例如，麻将牌、牌山、牌河这此由松饼为 Lua 添加的类型都属于 userdata。

```lua
t = T34.new("2m")
```

### 类型 nil

之前说过，`nil`就是什么都没有的意思。
只有`nil`这个值是 nil 类型的。

